-- Q1_Apr-Jun_2025

SELECT DISTINCT CouponOfferCode 
FROM (
    SELECT DISTINCT CouponOfferCode
    FROM coupon_offer_report
    WHERE UsedDate BETWEEN '2025-01-01' AND '2025-03-31'
    
    UNION 
    
    SELECT DISTINCT CouponOfferCode
    FROM coupon_offer_report
    WHERE IssuedDate BETWEEN '2025-01-01' AND '2025-03-31'
) AS A;

SELECT * FROM coupon_offer_report;

SELECT CouponOfferCode,COUNT(*)Issued
FROM coupon_offer_report
WHERE issueddate BETWEEN '2025-01-01' AND '2025-03-31'
AND issuedstore<>'demo'
GROUP BY 1;



 
 
SELECT  CouponOfferCode,
COUNT(couponcode)CouponsRedeemed,
COUNT(DISTINCT issuedmobile)Coupon_Redeemers, 
 SUM(discount)discount,
 SUM(b.amount)RedemptionSale 
FROM coupon_offer_report a 
JOIN txn_Report_accrual_Redemption b ON a.billno=b.modifiedbillno 
WHERE useddate BETWEEN '2025-01-01' AND '2025-03-31'
AND couponstatus = 'Used' 
AND redeemedstorecode<>'demo' 
GROUP BY 1; 





SELECT *  FROM coupon_offer_report;

WITH base_data AS
(SELECT DISTINCT CouponOfferCode FROM coupon_offer_report
WHERE CouponOfferCode IN(
'CEDC401Q4',
'CEDC201Q4',
'TXNJUL500N',
'EDC20Q1FY26',
'EDC40Q1FY26',
'FDTHR10M4FY26',
'FDTHR20M4FY26',
'EP10M4FY26',
'FDTHR15080426',
'FDTHR25080426',
'FDTHR05080426',
'FDTHR10080426',
'FDDSH25M4FY26',
'FDDSH15M4FY26',
'FDDSH20M4FY26',
'FDTHR20080426',
'FDDSH30M4FY26',
'TF250OFF2499',
'TC200OFF2099',
'TC300OFF2099',
'TC300OFF2499',
'TF300OFF2099',
'HBD400OFF2000',
'TF300OFF2099Manual',
'FDTHR10280426',
'TC200OFF2499M25M',
'TF200OFF2299M25',
'NTR250OFF1499M25M',
'NTR400OFF2800M25M',
'TC300OFF2499M25M',
'NTR200OFF2000M25M',
'TC200OFF2099M25M',
'TF150OFF1799M25',
'TC300OFF2099M25M',
'TC200OFF1999M25M',
'EP10M5FY26',
'TF300OFF2499M25',
'TF200OFF2099M25',
'FDDSH10M4FY26',
'FDTHR10160526',
'TC300OFF1999M25',
'TF300OFF2099M25',
'FDTHR20280426',
'EDC20Q1FY26MCR',
'EDC40Q1FY26MCR',
'20OFFSH2025SNew',
'FDTHR15160526',
'EP10M6FY26',
'TO200OFF13990625',
'TF300OFF20990625',
'TC200OFF20990625',
'NTR400OFF28000625',
'NTR200OFF20000625',
'TC250OFF24990625',
'TC300OFF24990625',
'TF250OFF24990625',
'TF300OFF24990625',
'TC300OFF20990625',
'TF200OFF20990625',
'FDTHR10030626',
'MGVBWF100',
'TO200OFF14990625',
'TO250OFF14990625',
'RACAVA10',
'FDTHR20030626',
'CRM5M6FY26',
'MG1000SMP',
'CRM8M6FY26',
'MG1000WEMP',
'NSOEXCAPLAVGJ',
'NSOLACAPLCVUP',
'NSOEXCAPLCVUP',
'NSODOCAPLSCGJ',
'NSODOCAPLCAGJ',
'NSOEXCAPLSCGJ',
'NSOEXCAPLCAGJ',
'RALUFY26',
'FDTHR10230626',
'NSOLACAPLSCGJ',
'TEST20P',
'CRM1M6FY26',
'RACAHL10' )),
 coupon AS
 (SELECT CouponOfferCode,narration FROM coupon_offer_report)
 
 SELECT a.CouponOfferCode,b.narration FROM base_data a JOIN coupon b
 ON a.CouponOfferCode=b.CouponOfferCode GROUP BY 1;
 
 
 
    (SELECT DISTINCT CouponOfferCode
    FROM coupon_offer_report
    WHERE UsedDate BETWEEN '2025-01-01' AND '2025-03-31');
    
    
    SELECT DISTINCT narration,CouponOfferCode FROM coupon_offer_report WHERE CouponOfferCode
     IN(
     'FDDSH25M4FY26',
'FDDSH15M4FY26',
'FDDSH20M4FY26',
'FDTHR20080426',
'FDDSH30M4FY26',
'TF250OFF2499',
'TC200OFF2099',
'TC300OFF2099',
'TC300OFF2499',
'TF300OFF2099',
'HBD400OFF2000',
'FDTHR10280426',
'EP10M5FY26',
'FDDSH10M4FY26',
'FDTHR10160526',
'FDTHR20280426',
'EDC20Q1FY26MCR',
'EDC40Q1FY26MCR',
'20OFFSH2025SNew',
'FDTHR15160526',
'EP10M6FY26',
'FDTHR10030626',
'MGVBWF100',
'FDTHR20030626',
'CRM5M6FY26',
'MG1000SMP',
'CRM8M6FY26',
'MG1000WEMP',
'NSOEXCAPLAVGJ',
'NSOLACAPLCVUP',
'NSOEXCAPLCVUP',
'NSODOCAPLSCGJ',
'NSODOCAPLCAGJ',
'NSOEXCAPLSCGJ',
'NSOEXCAPLCAGJ',
'RALUFY26',
'FDTHR10230626',
'NSOLACAPLSCGJ',
'CRM1M6FY26')
;
    
    
    
   WITH base AS 
  (SELECT DISTINCT CouponOfferCode FROM coupon_offer_report WHERE CouponOfferCode
IN('TXNJUL500N',
'MG12505999',
'MG10004599',
'100OFFINVS',
'MLSM310325',
'MALLSEP1K',
'MGP2751799',
'MGP7003699',
'60OFFINVS',
'750TIME',
'MGP5002799',
'2000TIME',
'THRLNC104',
'THRLNC154',
'THRLNC204',
'THRLNC254',
'20OFFSH2025',
'FFDS25Q4',
'FFDS15Q4',
'CEDC401Q4',
'EM10OFFDEC',
'FFDS20Q4',
'FFDS10Q4',
'CEDC201Q4',
'5002499JAN',
'6002999JAN',
'MALLSEP9D',
'THRLNC54',
'500TIME',
'VTD15200',
'VTD22300',
'THRLNC205',
'MALLSEP500',
'THRLNC105',
'THRLNC155',
'THRLNC055',
'C2WKND2950F',
'C6WKND2450F',
'C7WKND2450F',
'C5WKND2450F',
'C3WKND2450F',
'R500OFF1999S',
'R600OFF2999S',
'R500OFF2499S',
'FFDS30Q4',
'1000TIME',
'1500TIME',
'WDR500OFF1999S',
'WDR500OFF2499S',
'THRLNC255',
'27MAR500OFF1999',
'27MAR500OFF2499',
'27MAR600OFF2999',
'SPCL2500JAN',
'CEDN40OFFN'))
SELECT DISTINCT(a.CouponOfferCode),b.narration FROM  base a JOIN coupon_offer_report b
ON a.CouponOfferCode=b.CouponOfferCode
WHERE b.narration IS NOT NULL;


SELECT * FROM coupon_offer_report WHERE narration IS NULL LIMIT 10;
;

	
 INSERT INTO  dummy.coupon_data_as
 SELECT 
    a.issuedmobile,
    a.CouponOfferCode,
    COUNT(a.couponcode) AS CouponsRedeemed,
    1 AS Coupon_Redeemers,  
    SUM(a.discount) AS discount,
    SUM(b.amount) AS RedemptionSale
FROM 
    coupon_offer_report a 
JOIN 
    txn_Report_accrual_Redemption b 
    ON a.billno = b.modifiedbillno 
WHERE 
    a.useddate BETWEEN '2025-01-01' AND '2025-03-31'
    AND a.couponstatus = 'Used'
    AND a.redeemedstorecode <> 'demo'
GROUP BY 
    a.issuedmobile, 
    a.CouponOfferCode;
    #8248
    
    
    SELECT * FROM dummy.coupon_data_as;